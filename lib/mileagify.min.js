"use strict";var mileagifyJS=mileagifyJS||{};mileagifyJS.config={unit_system:"METRIC",region:"es",avg_consumption:5,price_fuel:1.4};mileagifyJS.map=function(){var e=null;var t={zoom:3,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",stylers:[{saturation:10}]}]};var n=function(e,n){t.center=new google.maps.LatLng(n[0],n[1]);mileagifyJS.map.object=new google.maps.Map(document.getElementById(e),t);mileagifyJS.route.directionsDisplay=new google.maps.DirectionsRenderer;mileagifyJS.route.directionsDisplay.setMap(mileagifyJS.map.object)};var r=function(e,t){this.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};return this.isNumber(e)&&e<=90&&e>=-90&&this.isNumber(t)&&t<=180&&t>=-180};var i=function(e){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){e(null,t)})}else{e("Your device doesn't support geolocation",null)}};var s=function(e,t){var n=new google.maps.Geocoder;n.geocode({address:e},function(e,n){if(n==google.maps.GeocoderStatus.OK){var r=e[0].geometry.location;var i=[r[Object.keys(r)[0]],r[Object.keys(r)[1]]];t(null,i)}else{t("Geocode was not successful due: "+n,null)}})};var o={object:e,render:n,isValidCoords:r,text2LatLng:s,getLocation:i};return o}();mileagifyJS.route=function(){var e={name:"",lat:null,lng:null};var t={name:"",lat:null,lng:null};var n=new google.maps.DirectionsRenderer;var r={unitSystem:google.maps.DirectionsUnitSystem[mileagifyJS.config.unit_system],region:mileagifyJS.config.region,optimizeWaypoints:true,travelMode:google.maps.DirectionsTravelMode["DRIVING"],provideRouteAlternatives:true};var i={data:null,path:null,render:function(){var e=new google.maps.Polyline({path:this.data,strokeColor:"#7FFF00",opacity:.5,zIndex:2,strokeWeight:4});if(this.path){this.path.setMap(null)}e.setMap(mileagifyJS.map.object);this.path=e}};var s={data:null,path:null,render:function(){var e=new google.maps.Polyline({path:this.data,strokeColor:"#7F00FF",opacity:.7,zIndex:1,strokeWeight:3});if(this.path){this.path.setMap(null)}e.setMap(mileagifyJS.map.object);this.path=e}};var o=function(n,i){if(typeof n=="object"){e.name=n;e.lat=n[0];e.lng=n[1]}else{e.name=n;e.lat=n.split(",",2)[0];e.lng=n.split(",",2)[1]}if(mileagifyJS.map.isValidCoords(e.lat,e.lng)){r.origin=new google.maps.LatLng(e.lat,e.lng);i()}else{mileagifyJS.map.text2LatLng(e.name,function(e,n){t.lat=n[0];t.lng=n[1];r.origin=n[0]+", "+n[1];i()})}};var u=function(e,n){if(typeof e=="object"){t.name=e;t.lat=e[0];t.lng=e[1]}else{t.name=e;t.lat=e.split(",",2)[0];t.lng=e.split(",",2)[1]}if(mileagifyJS.map.isValidCoords(t.lat,t.lng)){r.destination=new google.maps.LatLng(t.lat,t.lng);n()}else{mileagifyJS.map.text2LatLng(t.name,function(e,i){t.lat=i[0];t.lng=i[1];r.destination=i[0]+", "+i[1];n()})}};var a=function(e,t){return e.legs[0].distance.value-t.legs[0].distance.value};var f=function(e){return(e/1e3*mileagifyJS.config.avg_consumption/100).toFixed(2)};var l=function(e){return(e*2.5).toFixed(2)};var c=function(e){return(e*mileagifyJS.config.price_fuel).toFixed(2)};var h=function(e){this.directionsDisplay.setPanel(document.getElementById(e))};var p=function(e,t,n){var i=this;i.setFrom(e,function(){i.setTo(t,function(){r.avoidTolls=true;var s=new google.maps.DirectionsService;s.route(r,function(o,u){if(u==google.maps.DirectionsStatus.OK){r.avoidTolls=false;s.route(r,function(r,s){if(u==google.maps.DirectionsStatus.OK){i.gmDefault.data=o.routes[0].overview_path;o.routes=o.routes.concat(r.routes);var f={from:e,to:t,gm_m:o.routes[0].legs[0].distance.value,gm_s:o.routes[0].legs[0].duration.value};o.routes.sort(a);if(o.routes.length>5){o.routes.splice(o.routes.length-1,1)}i.directionsDisplay.setDirections(o);i.eco.data=o.routes[0].overview_path;f.eco_m=o.routes[0].legs[0].distance.value;f.eco_s=o.routes[0].legs[0].duration.value;f.hasDiff=f.gm_m!=f.eco_m;n(null,f)}else{n(s,null)}})}else{n(u,null)}})})})};var d={setFrom:o,setTo:u,eco:i,gmDefault:s,directionsDisplay:n,getFuelStat:f,getCO2Stat:l,getMoneyStat:c,showDirections:h,calculate:p};return d}()